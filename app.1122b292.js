(function(t){function e(e){for(var a,o,s=e[0],c=e[1],d=e[2],u=0,h=[];u<s.length;u++)o=s[u],i[o]&&h.push(i[o][0]),i[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);l&&l(e);while(h.length)h.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},i={1:0},r=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var d=0;d<s.length;d++)e(s[d]);var l=c;r.push([4,0]),n()})({4:function(t,e,n){t.exports=n("zUnb")},"4wxF":function(t,e,n){},EDI0:function(t,e,n){},"S/S/":function(t,e,n){},Sv4Z:function(t,e,n){"use strict";var a=n("4wxF"),i=n.n(a);i.a},ZL7j:function(t,e,n){"use strict";var a=n("EDI0"),i=n.n(a);i.a},hdnL:function(t,e,n){},oZqq:function(t,e,n){"use strict";var a=n("S/S/"),i=n.n(a);i.a},uH8l:function(t,e,n){"use strict";var a=n("hdnL"),i=n.n(a);i.a},zUnb:function(t,e,n){"use strict";n.r(e);n("rGqo"),n("Z2Ku"),n("L9s1"),n("VRzm");var a=n("Kw5r"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fullpage",attrs:{id:"app"}},[n("div",{staticClass:"header"},[n("h1",[t._v("bibigraph")]),"editor"==t.mainpanel?n("a",{staticClass:"navlink",attrs:{href:"javascript:"},on:{click:function(e){t.mainpanel="graph"}}},[t._v("graph")]):"graph"==t.mainpanel?n("a",{staticClass:"navlink",attrs:{href:"javascript:"},on:{click:function(e){t.mainpanel="editor"}}},[t._v("edit")]):t._e()]),n("div",{staticClass:"main"},[n("div",{staticClass:"leftpanel"},["editor"==t.mainpanel?n("grapheditor",{staticClass:"grapheditor"}):"graph"==t.mainpanel?n("graphviewer"):t._e()],1),t.selectednode?n("metadataviewer",{staticClass:"rightpanel",attrs:{doi:t.selectednode}}):t._e()],1)])},r=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"graphEditor"},[n("h3",[t._v("node list")]),n("table",[t._m(0),t._l(t.graphmetadata,function(e){return n("tr",[n("td",{staticClass:"selectbox"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedNodes,expression:"selectedNodes"}],attrs:{type:"checkbox",id:e.doi},domProps:{value:e.doi,checked:Array.isArray(t.selectedNodes)?t._i(t.selectedNodes,e.doi)>-1:t.selectedNodes},on:{change:function(n){var a=t.selectedNodes,i=n.target,r=!!i.checked;if(Array.isArray(a)){var o=e.doi,s=t._i(a,o);i.checked?s<0&&(t.selectedNodes=a.concat([o])):s>-1&&(t.selectedNodes=a.slice(0,s).concat(a.slice(s+1)))}else t.selectedNodes=r}}})]),n("td",[n("a",{attrs:{href:"#"},on:{click:function(n){t.showmetadata(e.doi)}}},[t._v(t._s(e.key))])]),n("td",[t._v(t._s(e.year))]),n("td",[t._v(t._s(e.citedbycount))]),n("td",[t._v(t._s(e.citedby.length))]),n("td",[t._v(" "+t._s(e.referenceWithDOI.length)+" "),n("a",{attrs:{href:"#"},on:{click:function(n){t.addRefsOf([e.doi])}}},[t._v("search")])]),n("td",[n("a",{attrs:{href:"#"},on:{click:function(n){t.removeFromGraph(e.doi)}}},[t._v("remove")])])])})],2),t.selectedNodes.length>0?n("p",[t._v(t._s(t.selectedNodes.length)+" selected: add, remove, add refs.")]):t._e(),n("h3",[t._v("store")]),n("p",{staticClass:"storelist"},t._l(t.alldoi,function(e){return n("span",{staticClass:"store_chip"},[n("a",{attrs:{href:"#"},on:{click:function(n){t.showmetadata(e)}}},[t._v(t._s(t._f("key")(e)))]),t.isInNodelist(e)?t._e():n("a",{attrs:{href:"#"},on:{click:function(n){t.addToGraph(e)}}},[t._v("[add]")])])})),n("h3",[t._v("add to store")]),n("form",[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.doitext,expression:"doitext"}],attrs:{placeholder:"give a doi list, comma or space separated",disabled:t.waiting},domProps:{value:t.doitext},on:{input:function(e){e.target.composing||(t.doitext=e.target.value)}}}),n("button",{attrs:{disabled:t.waiting},on:{click:function(e){t.submit(t.doitext)}}},[t._v("go")])]),n("p",[t._v("\n  Or use an example: "),n("a",{attrs:{href:"#"},on:{click:function(e){t.doitext="10.1103/PhysRevA.62.012306"}}},[t._v("set example 1")]),t._v(",\n  "),n("a",{attrs:{href:"#"},on:{click:function(e){t.doitext="10.1103/PhysRevA.62.012306, PhysRevA.62.012306Cc1R1"}}},[t._v("set example 2")]),t._v(",\n  "),n("a",{attrs:{href:"#"},on:{click:function(e){t.doitext="10.1103/physreva.51.1015, 10.1143/jpsj.43.1262,10.1109/tdei.2009.4784550,10.1038/30156,10.1103/physrevlett.1.275, 10.1080/00107519608217543"}}},[t._v("example 3")])]),n("p",[t._v("\n"+t._s(t.doilist)+"\n")]),t.waiting?n("span",[t._v("wait...")]):t._e()])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",[n("th",[t._v("all")]),n("th",[t._v("key")]),n("th",[t._v("year")]),n("th",[t._v("citedby"),n("br"),t._v("count")]),n("th",[t._v("nbr."),n("br"),t._v("known")]),n("th",[t._v("nbr ref. w/ doi")]),n("th",[t._v("actions")])])}],c=n("iv4g"),d=(n("KKXr"),n("yt8O"),n("RW0V"),n("xmWZ")),l=n("vDqi"),u=n.n(l),h=function t(e){Object(d["a"])(this,t),this.data=e,this.title=(e["title"]||[""])[0],this.year=e["issued"]["date-parts"][0][0],this.citedbycount=e["is-referenced-by-count"],this.referencescount=e["references-count"],this.url=e["URL"],this.doi=e["DOI"],this.journal=e["container-title"][0]||"",e["reference"]?(this.referenceWithDOI=e["reference"].filter(function(t){return t["DOI"]}).map(function(t){return t["DOI"]}),this.reference=e["reference"]):(this.reference=[],this.referenceWithDOI=[]),e["author"]?(this.authors=e["author"].map(function(t){return"".concat(t["given"]||""," ").concat(t["family"])}),this.key="".concat(e["author"][0]["family"]).concat(this.year)):(this.authors=[],this.key=this.doi),this.citedby=[]},f={},p="doi_";function v(t){var e=t.trim().toLowerCase();return"".concat(p).concat(e)}function m(t){return t.map(function(t){return f[v(t)]})}function _(){var t=Object.keys(f).map(function(t){return f[t].doi});m(t).forEach(function(t){t.citedby=[]}),m(t).forEach(function(t){var e=t.doi;m(t.referenceWithDOI).forEach(function(t){t&&t.citedby.push(e)})})}function g(){return Object.keys(f).map(function(t){return f[t].doi})}function y(t){var e=/^10.\d{4,9}\/[-._;()\/:A-Z0-9]+$/i;return e.test(t)}function b(t){t=t.filter(y);var e=O(t).then(function(t){return t.forEach(function(t){f[v(t.doi)]=t}),_(),t});return e}var k="https://github.com/xdze2",w=16,C="https://api.crossref.org/works";function x(t){console.log("ðŸ“¡  ".concat(t.length," doi requested"));var e=t.map(function(t){return"doi:".concat(t)}).join(","),n=u.a.get(C,{params:{filter:e,mailto:k,rows:w},responseType:"json"}).then(function(t){var e=t.data.message.items;return e.map(function(t){return new h(t)})}).catch(function(t){return console.log("<< query error !! >>"),console.log(t.request),[]});return n}function O(t){for(var e=t.length,n=[],a=0;a<e;a+=w){var i=t.slice(a,a+w);i.length>0&&n.push(i)}var r=n.map(x),o=Promise.all(r).then(function(t){var e;return(e=[]).concat.apply(e,Object(c["a"])(t))});return o}var j=a["a"].extend({name:"graphEditor",props:[],created:function(){var t=this;this.alldoi=g(),Y.$on("storageUpdate",function(){console.log("event in graph ed, storage"),t.$forceUpdate(),t.alldoi=g()})},data:function(){return{doitext:"",data:void 0,waiting:!1,alldoi:void 0,nodelist:tt.state.nodelist,links:tt.state.links,selectedNodes:[]}},computed:{doilist:function(){return this.parse_doitext(this.doitext)},graphmetadata:function(){return m(this.nodelist)}},filters:{key:function(t){return m([t])[0].key}},methods:{submit:function(t){var e=this,n=this.parse_doitext(t);this.waiting=!0,this.doitext="",b(n).then(function(t){e.waiting=!1,e.alldoi=g()})},parse_doitext:function(t){return this.doitext.split(/[,;\s]/).filter(function(t){return t})},addToGraph:function(t){tt.addToGraph(t)},removeFromGraph:function(t){tt.removeFromGraph(t)},isInNodelist:function(t){var e=this.nodelist.filter(function(e){return e==t});return e.length>0},addRefsOf:function(t){var e,n=this,a=m(t),i=a.map(function(t){return t.referenceWithDOI});i=(e=[]).concat.apply(e,Object(c["a"])(i)),b(i).then(function(t){n.alldoi=g()})},showmetadata:function(t){Y.$emit("showmetadata",t)}},components:{}}),I=j,G=(n("uH8l"),n("KHd+")),D=Object(G["a"])(I,o,s,!1,null,"e55e4718",null),E=D.exports,L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"metadataviewer"},[n("a",{staticClass:"close",attrs:{href:"#"},on:{click:function(e){t.closepanel()}}},[t._v("close[x]")]),t.metadata?n("div",[n("span",{staticClass:"refnumber"},[t._v(t._s(t.metadata.key))]),n("h3",[t._v(t._s(t.metadata.title))]),n("p",t._l(t.metadata.authors,function(e){return n("span",{staticClass:"author"},[t._v(t._s(e)+", ")])})),t._v("\n    "+t._s(t.metadata.year)+" - "+t._s(t.metadata.journal)+" "),n("br"),n("a",{staticClass:"doilink",attrs:{href:t.metadata.url,target:"_blank"}},[t._v(t._s(t.metadata.doi))]),n("h4",[t._v("Actions")]),n("div",{staticClass:"actionsection"},[t.isInGraph?n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(e){t.removeFromGraph(t.doi)}}},[t._v("remove from graph")]):n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(e){t.addToGraph(t.doi)}}},[t._v("add to graph")]),n("br")]),n("h4",[t._v("Citations")]),t._v("\n    Cited "+t._s(t.metadata.citedbycount)+" times.\n    "),t.citedby?n("table",{attrs:{cellpadding:"0",cellspacing:"0"}},t._l(t.citedby,function(e){return n("tr",[e.ingraph?n("td",[t._v(t._s("âœ”"))]):n("td",[t._v("-")]),n("td",{staticClass:"refkey"},[t._v(t._s(e.key))]),n("td",[t._v(t._s(e.citedbycount))]),n("td",[n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){t.showmetadata(e.doi)}}},[t._v("view")]),e.ingraph?n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){t.removeFromGraph(e.doi)}}},[t._v("remove")]):n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){t.addToGraph(e.doi)}}},[t._v("add")])])])})):t._e(),n("h4",[t._v("References")]),t.hasMissingRefs?n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(e){t.queryMissingRefs()}}},[t._v("search the missing refs.")]):t._e(),t.reference?n("table",{attrs:{cellpadding:"0",cellspacing:"0"}},t._l(t.reference,function(e,a){return n("tr",[n("td",{staticClass:"refnumber"},[t._v(t._s(a+1)+".")]),e.ingraph?[n("td",{staticClass:"refkey"},[t._v(t._s(e.key))]),n("td",[t._v(t._s(e.citedbycount))]),n("td",[n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){t.showmetadata(e.doi)}}},[t._v("view")]),n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){t.removeFromGraph(e.doi)}}},[t._v("remove")])])]:e.instore?[n("td",[t._v(t._s(e.key))]),n("td",[t._v(t._s(e.citedbycount))]),n("td",[n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){t.showmetadata(e.doi)}}},[t._v("view")]),n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){t.addToGraph(e.doi)}}},[t._v("add")])])]:e.doi?[n("td",{staticClass:"ref-missing",attrs:{colspan:"3"}},[t._v(t._s(e.doi))])]:[n("td",{staticClass:"ref-nodoi",attrs:{colspan:"3"}},[t._v("-")])]],2)})):t._e(),n("p",[t._v(t._s(t.metadata.referencescount)+" references, "+t._s(t.metadata.referenceWithDOI.length)+" with a doi.")])]):n("div",[t._v("\n      No metadata for "+t._s(t.doi)+". "),t._m(0)])])},$=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("a",{attrs:{href:""}},[t._v("Look on crossref")])])}],N=(n("91GP"),n("LvDl")),R=n.n(N),T=a["a"].extend({name:"metadataViewer",props:["doi"],data:function(){return{nodelist:tt.state.nodelist,graph:{nodes:[],links:[]},metadata:{}}},computed:{isInGraph:function(){return R.a.includes(this.nodelist,this.doi)},reference:function(){return this.metadata.reference?this.parseRefField(this.metadata.reference):null},hasMissingRefs:function(){return this.reference.some(function(t){return!t.instore})},citedby:function(){var t=this;return this.metadata.citedby.map(function(e){return{key:m([e])[0].key,doi:e,ingraph:t.isDoiInGraph(e)}})}},created:function(){console.log("hello meta",this.doi),this.metadata=m([this.doi])[0]},beforeUpdate:function(){this.metadata=m([this.doi])[0]},methods:{parseRefField:function(t){var e=this,n=t.filter(function(t){return t.DOI}).map(function(t){return t.DOI}),a=n.map(function(t){var n=m([t])[0],a=n?n.key:t;return{doi:t,key:a,instore:!!n,ingraph:e.isDoiInGraph(t),citedbycount:n?n.citedbycount:"#"}});return a},isDoiInGraph:function(t){return 1==this.nodelist.filter(function(e){return e.toLowerCase()===t.toLowerCase()}).length},addToGraph:function(t){tt.addToGraph(t)},removeFromGraph:function(t){tt.removeFromGraph(t)},closepanel:function(){Y.$emit("closemetadata")},showmetadata:function(t){Y.$emit("showmetadata",t)},queryMissingRefs:function(){var t=this,e=this.metadata.referenceWithDOI;e=e.filter(function(t){return!m([t])[0]}),b(e).then(function(e){console.log("refs added"),t.metadata=Object.assign({},m([t.doi])[0]),Y.$emit("storageUpdate")})}}}),A=T,F=(n("Sv4Z"),Object(G["a"])(A,L,$,!1,null,"47edbf60",null)),P=F.exports,q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"graphviewer"},[n("div",{staticClass:"toolbar"},[n("a",{attrs:{href:"#"},on:{click:function(e){t.rendergraph()}}},[t._v("render")])]),n("div",{staticClass:"graphpanel"},[n("svg",{attrs:{id:"svggraph",height:"100%",width:"100%"}})])])},S=[],W=(n("pIFo"),n("VphZ")),Z=n("EiaH"),M=n.n(Z),U=a["a"].extend({name:"GraphViewer",props:[],data:function(){return{selectednode:null,nodes:tt.state.nodelist,links:tt.state.links}},mounted:function(){},updated:function(){console.log("graph view update!")},watch:{},methods:{doiToCssID:function(t){return t=t.replace(/[\./]/g,""),"doi".concat(t)},rendergraph:function(){var t=this;if(console.log(" Do you see a graph? ðŸ¦† "),0==this.nodes.length)return console.log("zero node"),0;var e=(new M.a.graphlib.Graph).setGraph({rankdir:"LR"});this.nodes.forEach(function(n){var a=m([n])[0],i=a.doi,r=1,o=a?a.key:i,s="".concat(o),c=[];a&&0!=a.referenceWithDOI.length||c.push("norefprovided"),c.push("gen".concat(r)),e.setNode(i,{label:s,id:t.doiToCssID(i),class:c.join(" ")})}),this.links.forEach(function(t){e.setEdge(t[0],t[1],{curve:W["a"],style:"stroke: #001; fill:none; stroke-width: 2px;",weight:1})});var n=new M.a.render,a=W["c"]("svg");a.selectAll("*").remove();var i=a.append("g"),r=W["c"]("svg>g");r.length=1,n(r,e);var o=a.node().getBoundingClientRect(),s=[o.width,o.height],c=s[0],d=s[1],l=[e.graph().width,e.graph().height],u=l[0],h=l[1],f=.96*Math.min(c/u,d/h),p=(c-f*u)/2,v=(d-f*h)/2;i.attr("transform","translate( ".concat(p,", ").concat(v,") scale(").concat(f,")"));var _=W["d"]().on("zoom",function(){i.attr("transform",W["b"].transform)});a.call(_),_.scaleExtent([f,4*f]),a.selectAll("g.node").on("click",function(n){e.node(n);t.selectednode=n,Y.$emit("showmetadata",n),a.selectAll(".node").classed("selected",!1),a.selectAll("#"+t.doiToCssID(n)).classed("selected",!0)}),a.selectAll(".node rect").attr("rx","3").attr("ry","3"),this.selectednode&&a.selectAll("#"+this.doiToCssID(this.selectednode)).classed("selected",!0)}},components:{}}),z=U,H=(n("oZqq"),Object(G["a"])(z,q,S,!1,null,null,null)),V=H.exports,K=a["a"].extend({name:"home",components:{grapheditor:E,metadataviewer:P,graphviewer:V},data:function(){return{mainpanel:"editor",graph:null,graphspec:null,drawSecondary:!0,selectednode:void 0,nodelist:tt.state.nodelist}},created:function(){var t=this;Y.$on("newgraphrequest",function(e){t.state="building",t.graphspec=e}),Y.$on("graphfinished",function(e){t.state="view",t.graph=e}),Y.$on("showmetadata",function(e){t.selectednode=e}),Y.$on("closemetadata",function(){t.selectednode=void 0}),Y.$on("storageUpdate",function(){t.$forceUpdate()})}}),B=K,J=(n("ZL7j"),Object(G["a"])(B,i,r,!1,null,null,null)),X=J.exports;n("k5N+"),n("Vd3H"),n("HEwt"),n("rE2o"),n("ioFf"),n("T39b");function Q(t){var e=[];return t=t.map(function(t){return t.toLowerCase()}),m(t).forEach(function(n){var a=n.doi,i=n.referenceWithDOI.filter(function(e){return R.a.includes(t,e.toLowerCase())});console.log("len refs in :",i.length),i.forEach(function(t){e.push([t.toLowerCase(),a.toLowerCase()])})}),e}n.d(e,"EventBus",function(){return Y}),n.d(e,"graph",function(){return tt}),a["a"].config.productionTip=!1;var Y=new a["a"],tt={state:{nodelist:[],links:[]},isInNodelist:function(t){var e=this.state.nodelist.filter(function(e){return e.doi==t});return e.length>0},addToGraph:function(t){R.a.includes(this.state.nodelist,t)||(this.state.nodelist.push(t.toLowerCase()),this.updateLinks())},removeFromGraph:function(t){t=t.toLowerCase(),this.state.nodelist.splice(this.state.nodelist.indexOf(t),1),this.updateLinks()},updateLinks:function(){var t=this;this.state.links.splice(0,this.state.links.length),Q(this.state.nodelist).forEach(function(e){t.state.links.push(e)}),console.log("nbr links:",this.state.links)}};new a["a"]({render:function(t){return t(X)}}).$mount("#app")}});
//# sourceMappingURL=app.1122b292.js.map