(function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],u=0,h=[];u<s.length;u++)o=s[u],a[o]&&h.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);d&&d(t);while(h.length)h.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={1:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=c;i.push([4,0]),n()})({4:function(e,t,n){e.exports=n("zUnb")},EDI0:function(e,t,n){},OPYh:function(e,t,n){"use strict";var r=n("fW9c"),a=n.n(r);a.a},"S/S/":function(e,t,n){},ZL7j:function(e,t,n){"use strict";var r=n("EDI0"),a=n.n(r);a.a},fW9c:function(e,t,n){},oZqq:function(e,t,n){"use strict";var r=n("S/S/"),a=n.n(r);a.a},tjQ6:function(e,t,n){"use strict";var r=n("zn95"),a=n.n(r);a.a},zUnb:function(e,t,n){"use strict";n.r(t);n("rGqo"),n("VRzm");var r=n("Kw5r"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fullpage",attrs:{id:"app"}},[n("div",{staticClass:"header"},[n("h1",[e._v("bibigraph")]),"editor"==e.mainpanel?n("a",{staticClass:"navlink",attrs:{href:"javascript:"},on:{click:function(t){e.mainpanel="graph"}}},[e._v("graph")]):"graph"==e.mainpanel?n("a",{staticClass:"navlink",attrs:{href:"javascript:"},on:{click:function(t){e.mainpanel="editor"}}},[e._v("edit")]):e._e()]),n("div",{staticClass:"main"},[n("div",{staticClass:"leftpanel"},["editor"==e.mainpanel?n("grapheditor",{staticClass:"grapheditor"}):"graph"==e.mainpanel?n("graphviewer"):e._e()],1),e.selectednode?n("metadataviewer",{staticClass:"rightpanel",attrs:{doi:e.selectednode}}):e._e()],1)])},i=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"graphEditor"},[n("h3",[e._v("node list")]),e.selectedNodes.length>0?n("p",[e._v(e._s(e.selectedNodes.length)+" selected:\n  "),n("a",{attrs:{href:"#"},on:{click:function(t){e.removeFromGraph(e.selectedNodes),e.selectedNodes=[],e.selectall=!1}}},[e._v("remove")]),e._v(",\n  "),n("a",{attrs:{href:"#"},on:{click:function(t){e.searchRefsOf(e.selectedNodes)}}},[e._v("search missing refs.")]),e._v(",\n  add refs. to the graph\n")]):e._e(),e.graphmetadata.length?n("table",[n("tr",[n("th",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.selectall,expression:"selectall"}],attrs:{type:"checkbox",id:"selectall"},domProps:{checked:Array.isArray(e.selectall)?e._i(e.selectall,null)>-1:e.selectall},on:{change:function(t){var n=e.selectall,r=t.target,a=!!r.checked;if(Array.isArray(n)){var i=null,o=e._i(n,i);r.checked?o<0&&(e.selectall=n.concat([i])):o>-1&&(e.selectall=n.slice(0,o).concat(n.slice(o+1)))}else e.selectall=a}}})]),n("th",[e._v("key")]),n("th",[e._v("year")]),n("th",{staticStyle:{"text-align":"right"}},[e._v("citations")]),n("th",[e._v("(known)")]),n("th",[e._v("[in graph]")]),n("th",[e._v("refs.")]),n("th",[e._v("(doi)")]),n("th",[e._v("[in graph]")]),n("th",[e._v("actions")])]),e._l(e.graphmetadata,function(t){return n("tr",[n("td",{staticClass:"selectbox"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedNodes,expression:"selectedNodes"}],attrs:{type:"checkbox",id:t.doi},domProps:{value:t.doi,checked:Array.isArray(e.selectedNodes)?e._i(e.selectedNodes,t.doi)>-1:e.selectedNodes},on:{change:function(n){var r=e.selectedNodes,a=n.target,i=!!a.checked;if(Array.isArray(r)){var o=t.doi,s=e._i(r,o);a.checked?s<0&&(e.selectedNodes=r.concat([o])):s>-1&&(e.selectedNodes=r.slice(0,s).concat(r.slice(s+1)))}else e.selectedNodes=i}}})]),n("td",[n("a",{attrs:{href:"#"},on:{click:function(n){e.showmetadata(t.doi)}}},[e._v(e._s(t.key))])]),n("td",[e._v(e._s(t.year))]),n("td",{staticStyle:{"text-align":"right"}},[e._v(e._s(t.citedbycount))]),n("td",[e._v("("+e._s(t.citedby.length)+")\n    "),e.nbrInGraph(t.citedby)<t.citedby.length?n("a",{attrs:{href:"#"},on:{click:function(n){e.addToGraph(t.citedby)}}},[e._v("add")]):e._e()]),n("td",[e._v(e._s(e.nbrInGraph(t.citedby))+"\n  ")]),n("td",[e._v(e._s(t.referencescount))]),n("td",[e._v(" "+e._s(t.referenceWithDOI.length)+"\n    "),t.referenceWithDOI.length&&e.hasUnknownRefs(t.referenceWithDOI)?n("a",{attrs:{href:"#"},on:{click:function(n){e.searchRefsOf([t.doi])}}},[e._v("search")]):t.referenceWithDOI.length?e.nbrInGraph(t.referenceWithDOI)<t.referenceWithDOI.length?n("a",{attrs:{href:"#"},on:{click:function(n){e.addToGraph(t.referenceWithDOI)}}},[e._v("add")]):n("span",[e._v("âœ“")]):n("span",[e._v(":/")])]),n("td",[e._v("\n    ("+e._s(e.nbrInGraph(t.referenceWithDOI))+")\n    "),e.nbrInGraph(t.referenceWithDOI)?n("a",{attrs:{href:"#"},on:{click:function(n){e.removeFromGraph(t.referenceWithDOI)}}},[e._v("remove")]):e._e()]),n("td",[n("a",{attrs:{href:"#"},on:{click:function(n){e.removeFromGraph([t.doi])}}},[e._v("remove ")])])])})],2):n("p",[e._v(" no node ")]),n("h3",[e._v("store")]),n("p",{staticClass:"storelist"},e._l(e.alldoi,function(t){return n("span",{staticClass:"store_chip"},[n("a",{attrs:{href:"#"},on:{click:function(n){e.showmetadata(t)}}},[e._v(e._s(e._f("key")(t)))]),e.isInNodelist(t)?e._e():n("a",{attrs:{href:"#"},on:{click:function(n){e.addToGraph([t])}}},[e._v("[add]")])])})),n("h3",[e._v("add to store")]),n("form",[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.doitext,expression:"doitext"}],attrs:{placeholder:"give a doi list, comma or space separated",disabled:e.waiting},domProps:{value:e.doitext},on:{input:function(t){t.target.composing||(e.doitext=t.target.value)}}}),n("button",{attrs:{disabled:e.waiting},on:{click:function(t){e.submit(e.doitext)}}},[e._v("go")])]),n("p",[e._v("\n  Or use an example: "),n("a",{attrs:{href:"#"},on:{click:function(t){e.doitext="10.1103/PhysRevA.62.012306"}}},[e._v("set example 1")]),e._v(",\n  "),n("a",{attrs:{href:"#"},on:{click:function(t){e.doitext="10.1103/PhysRevA.62.012306, PhysRevA.62.012306Cc1R1"}}},[e._v("set example 2")]),e._v(",\n  "),n("a",{attrs:{href:"#"},on:{click:function(t){e.doitext="10.1103/physreva.51.1015, 10.1143/jpsj.43.1262,10.1109/tdei.2009.4784550,10.1038/30156,10.1103/physrevlett.1.275, 10.1080/00107519608217543"}}},[e._v("example 3")])]),n("p",[e._v("\n"+e._s(e.doilist)+"\n")]),e.waiting?n("span",[e._v("wait...")]):e._e()])},s=[],c=(n("Z2Ku"),n("L9s1"),n("iv4g")),l=(n("KKXr"),n("yt8O"),n("RW0V"),n("xmWZ")),d=n("vDqi"),u=n.n(d),h=function e(t){Object(l["a"])(this,e),this.data=t,this.title=(t["title"]||[""])[0],this.year=t["issued"]["date-parts"][0][0],this.citedbycount=t["is-referenced-by-count"],this.referencescount=t["references-count"],this.url=t["URL"],this.doi=t["DOI"],this.journal=t["container-title"][0]||"",t["reference"]?(this.referenceWithDOI=t["reference"].filter(function(e){return e["DOI"]}).map(function(e){return e["DOI"]}),this.reference=t["reference"]):(this.reference=[],this.referenceWithDOI=[]),t["author"]?(this.authors=t["author"].map(function(e){return"".concat(e["given"]||""," ").concat(e["family"])}),this.key="".concat(t["author"][0]["family"]).concat(this.year)):(this.authors=[],this.key=this.doi),this.citedby=[]},f={},v="doi_";function p(e){var t=e.trim().toLowerCase();return"".concat(v).concat(t)}function m(e){return e.map(function(e){return f[p(e)]})}function _(){var e=Object.keys(f).map(function(e){return f[e].doi});m(e).forEach(function(e){e.citedby=[]}),m(e).forEach(function(e){var t=e.doi;m(e.referenceWithDOI).forEach(function(e){e&&e.citedby.push(t)})})}function g(){return Object.keys(f).map(function(e){return f[e].doi})}function y(e){var t=/^10.\d{4,9}\/[-._;()\/:A-Z0-9]+$/i;return t.test(e)}function w(e){e=e.filter(y);var t=C(e).then(function(e){return e.forEach(function(e){f[p(e.doi)]=e}),_(),e});return t}var b="https://github.com/xdze2",k=16,x="https://api.crossref.org/works";function O(e){console.log("ðŸ“¡  ".concat(e.length," doi requested"));var t=e.map(function(e){return"doi:".concat(e)}).join(","),n=u.a.get(x,{params:{filter:t,mailto:b,rows:k},responseType:"json"}).then(function(e){var t=e.data.message.items;return t.map(function(e){return new h(e)})}).catch(function(e){return console.log("<< query error !! >>"),console.log(e.request),[]});return n}function C(e){for(var t=e.length,n=[],r=0;r<t;r+=k){var a=e.slice(r,r+k);a.length>0&&n.push(a)}var i=n.map(O),o=Promise.all(i).then(function(e){var t;return(t=[]).concat.apply(t,Object(c["a"])(e))});return o}var j=n("LvDl"),I=n.n(j),G=r["a"].extend({name:"graphEditor",props:[],created:function(){var e=this;this.alldoi=g(),oe.$on("storageUpdate",function(){console.log("event in graph ed, storage"),e.$forceUpdate(),e.alldoi=g()})},data:function(){return{doitext:"",data:void 0,waiting:!1,alldoi:void 0,nodelist:se.state.nodelist,links:se.state.links,selectedNodes:[],selectall:!1}},computed:{doilist:function(){return this.parse_doitext(this.doitext)},graphmetadata:function(){return m(this.nodelist)}},watch:{selectall:function(e,t){this.selectedNodes=e?this.nodelist.slice(0):[]}},filters:{key:function(e){return m([e])[0].key}},methods:{submit:function(e){var t=this,n=this.parse_doitext(e);this.waiting=!0,this.doitext="",w(n).then(function(e){t.waiting=!1,t.alldoi=g()})},parse_doitext:function(e){return this.doitext.split(/[,;\s]/).filter(function(e){return e})},addToGraph:function(e){se.addToGraph(e)},removeFromGraph:function(e){se.removeFromGraph(e)},isInNodelist:function(e){var t=this.nodelist.filter(function(t){return t==e});return t.length>0},searchRefsOf:function(e){var t,n=this,r=m(e),a=r.map(function(e){return e.referenceWithDOI});a=(t=[]).concat.apply(t,Object(c["a"])(a)),w(a).then(function(e){n.alldoi=g()})},showmetadata:function(e){oe.$emit("showmetadata",e)},hasUnknownRefs:function(e){return e=m(e).filter(function(e){return!e}),e.length},nbrInGraph:function(e){var t=this;return e.filter(function(e){return I.a.includes(t.nodelist,e.toLowerCase())}).length}},components:{}}),D=G,E=(n("OPYh"),n("KHd+")),N=Object(E["a"])(D,o,s,!1,null,"3feb3fe8",null),S=N.exports,A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"metadataviewer"},[n("a",{staticClass:"close",attrs:{href:"#"},on:{click:function(t){e.closepanel()}}},[e._v("close[x]")]),e.metadata?n("div",[n("span",{staticClass:"refnumber"},[e._v(e._s(e.metadata.key))]),n("h3",[e._v(e._s(e.metadata.title))]),n("p",e._l(e.metadata.authors,function(t){return n("span",{staticClass:"author"},[e._v(e._s(t)+", ")])})),e._v("\n    "+e._s(e.metadata.year)+" - "+e._s(e.metadata.journal)+" "),n("br"),n("a",{staticClass:"doilink",attrs:{href:e.metadata.url,target:"_blank"}},[e._v(e._s(e.metadata.doi))]),n("h4",[e._v("Actions")]),n("div",{staticClass:"actionsection"},[e.isInGraph?n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(t){e.removeFromGraph([e.doi])}}},[e._v("remove from graph")]):n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(t){e.addToGraph([e.doi])}}},[e._v("add to graph")]),n("br")]),n("h4",[e._v("Citations")]),e._v("\n    Cited "+e._s(e.metadata.citedbycount)+" times.\n    "),e.citedby?n("table",{attrs:{cellpadding:"0",cellspacing:"0"}},e._l(e.citedby,function(t){return n("tr",[t.ingraph?n("td",[e._v(e._s("âœ”"))]):n("td",[e._v("-")]),n("td",{staticClass:"refkey"},[e._v(e._s(t.key))]),n("td",[e._v(e._s(t.citedbycount))]),n("td",[n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){e.showmetadata(t.doi)}}},[e._v("view")]),t.ingraph?n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){e.removeFromGraph([t.doi])}}},[e._v("remove")]):n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){e.addToGraph([t.doi])}}},[e._v("add")])])])})):e._e(),n("h4",[e._v("References")]),e.hasMissingRefs?n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(t){e.queryMissingRefs()}}},[e._v("search the missing refs.")]):e._e(),e.reference?n("table",{attrs:{cellpadding:"0",cellspacing:"0"}},e._l(e.reference,function(t,r){return n("tr",[n("td",{staticClass:"refnumber"},[e._v(e._s(r+1)+".")]),t.ingraph?[n("td",{staticClass:"refkey"},[e._v(e._s(t.key))]),n("td",[e._v(e._s(t.citedbycount))]),n("td",[n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){e.showmetadata(t.doi)}}},[e._v("view")]),n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){e.removeFromGraph([t.doi])}}},[e._v("remove")])])]:t.instore?[n("td",[e._v(e._s(t.key))]),n("td",[e._v(e._s(t.citedbycount))]),n("td",[n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){e.showmetadata(t.doi)}}},[e._v("view")]),n("a",{staticClass:"action",attrs:{href:"#"},on:{click:function(n){e.addToGraph([t.doi])}}},[e._v("add")])])]:t.doi?[n("td",{staticClass:"ref-missing",attrs:{colspan:"3"}},[e._v(e._s(t.doi))])]:[n("td",{staticClass:"ref-nodoi",attrs:{colspan:"3"}},[e._v("-")])]],2)})):e._e(),n("p",[e._v(e._s(e.metadata.referencescount)+" references, "+e._s(e.metadata.referenceWithDOI.length)+" with a doi.")])]):n("div",[e._v("\n      No metadata for "+e._s(e.doi)+". "),e._m(0)])])},W=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[n("a",{attrs:{href:""}},[e._v("Look on crossref")])])}],R=(n("91GP"),r["a"].extend({name:"metadataViewer",props:["doi"],data:function(){return{nodelist:se.state.nodelist,graph:{nodes:[],links:[]},metadata:{}}},computed:{isInGraph:function(){return I.a.includes(this.nodelist,this.doi)},reference:function(){return this.metadata.reference?this.parseRefField(this.metadata.reference):null},hasMissingRefs:function(){return this.reference.some(function(e){return!e.instore})},citedby:function(){var e=this;return this.metadata.citedby.map(function(t){return{key:m([t])[0].key,doi:t,ingraph:e.isDoiInGraph(t)}})}},created:function(){console.log("hello meta",this.doi),this.metadata=m([this.doi])[0]},beforeUpdate:function(){this.metadata=m([this.doi])[0]},methods:{parseRefField:function(e){var t=this,n=e.filter(function(e){return e.DOI}).map(function(e){return e.DOI}),r=n.map(function(e){var n=m([e])[0],r=n?n.key:e;return{doi:e,key:r,instore:!!n,ingraph:t.isDoiInGraph(e),citedbycount:n?n.citedbycount:"#"}});return r},isDoiInGraph:function(e){return 1==this.nodelist.filter(function(t){return t.toLowerCase()===e.toLowerCase()}).length},addToGraph:function(e){se.addToGraph(e)},removeFromGraph:function(e){se.removeFromGraph(e)},closepanel:function(){oe.$emit("closemetadata")},showmetadata:function(e){oe.$emit("showmetadata",e)},queryMissingRefs:function(){var e=this,t=this.metadata.referenceWithDOI;t=t.filter(function(e){return!m([e])[0]}),w(t).then(function(t){console.log("refs added"),e.metadata=Object.assign({},m([e.doi])[0]),oe.$emit("storageUpdate")})}}})),T=R,$=(n("tjQ6"),Object(E["a"])(T,A,W,!1,null,"31fc7eb4",null)),L=$.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"graphviewer"},[n("div",{staticClass:"toolbar"},[n("a",{attrs:{href:"#"},on:{click:function(t){e.rendergraph()}}},[e._v("render")]),n("br"),n("input",{directives:[{name:"model",rawName:"v-model",value:e.drawsecondary,expression:"drawsecondary"}],attrs:{type:"checkbox",id:"drawsecondary"},domProps:{checked:Array.isArray(e.drawsecondary)?e._i(e.drawsecondary,null)>-1:e.drawsecondary},on:{change:function(t){var n=e.drawsecondary,r=t.target,a=!!r.checked;if(Array.isArray(n)){var i=null,o=e._i(n,i);r.checked?o<0&&(e.drawsecondary=n.concat([i])):o>-1&&(e.drawsecondary=n.slice(0,o).concat(n.slice(o+1)))}else e.drawsecondary=a}}}),e._v(" draw secondary\n")]),n("div",{staticClass:"graphpanel"},[n("svg",{attrs:{id:"svggraph",height:"100%",width:"100%"}})])])},F=[],q=n("k5N+"),U=(n("pIFo"),n("VphZ")),M=n("EiaH"),z=n.n(M);n("Vd3H"),n("HEwt"),n("rE2o"),n("ioFf"),n("T39b");function Z(e){var t={},n=new Set,r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,l=Object(q["a"])(c,2),d=l[0],u=l[1];t[d]?t[d].push(u):t[d]=[u],n.add(d),n.add(u)}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return[t,n]}function V(e,t,n,r,a){var i=!0,o=!1,s=void 0;try{for(var c,l=(e[t]||[])[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var d=c.value;n.has(d)?r.has(d)||a.add([t,d].join("_edge_")):(n.add(d),V(e,d,n,r,a))}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}r.add(t)}function K(e){for(var t=new Set,n=new Set,r=new Set,a=Object.keys(e),i=0;i<a.length;i++){var o=a[i];t.has(o)||(t.add(o),V(e,o,t,n,r))}return r}function H(e,t){var n=new Set(t.map(function(e){return e.join("_edge_")})),r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,l=!0,d=!1,u=void 0;try{for(var h,f=e[Symbol.iterator]();!(l=(h=f.next()).done);l=!0){var v=h.value,p=[v,c].join("_edge_"),m=!0,_=!1,g=void 0;try{for(var y,w=e[Symbol.iterator]();!(m=(y=w.next()).done);m=!0){var b=y.value;if(v!==b){var k=[v,b].join("_edge_"),x=[c,b].join("_edge_");!n.has(k)&&n.has(p)&&n.has(x)&&n.add(k)}}}catch(e){_=!0,g=e}finally{try{m||null==w.return||w.return()}finally{if(_)throw g}}}}catch(e){d=!0,u=e}finally{try{l||null==f.return||f.return()}finally{if(d)throw u}}}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}function B(e,t){var n=new Set(t),r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,l=c.split("_edge_"),d=Object(q["a"])(l,2),u=d[0],h=d[1],f=!0,v=!1,p=void 0;try{for(var m,_=e[Symbol.iterator]();!(f=(m=_.next()).done);f=!0){var g=m.value,y=[u,g].join("_edge_"),w=[g,h].join("_edge_");t.has(y)&&t.has(w)&&n.delete(c)}}catch(e){v=!0,p=e}finally{try{f||null==_.return||_.return()}finally{if(v)throw p}}}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}function J(e){var t=Z(e),n=Object(q["a"])(t,2),r=n[0],a=n[1],i=K(r),o=e.filter(function(e){return!i.has(e.join("_edge_"))}),s=H(a,o),c=B(a,s),l=e.filter(function(e){return!c.has(e.join("_edge_"))});return[Array.from(c).map(function(e){return e.split("_edge_")}),l]}function Q(e){var t=[];return e=e.map(function(e){return e.toLowerCase()}),m(e).forEach(function(n){var r=n.doi,a=n.referenceWithDOI.filter(function(t){return I.a.includes(e,t.toLowerCase())});console.log("len refs in :",a.length),a.forEach(function(e){t.push([e.toLowerCase(),r.toLowerCase()])})}),t}var Y=r["a"].extend({name:"GraphViewer",props:[],data:function(){return{selectednode:null,nodes:se.state.nodelist,drawsecondary:!0}},mounted:function(){},updated:function(){console.log("graph view update!")},watch:{drawsecondary:function(){console.log("hello, prop watched"),this.rendergraph()},nodes:function(){console.log("render!"),this.rendergraph()}},methods:{doiToCssID:function(e){return e=e.replace(/[\./]/g,""),"doi".concat(e)},rendergraph:function(){var e=this;if(console.log(" Do you see a graph? ðŸ¦† "),0==this.nodes.length)return console.log("zero node"),0;var t=(new z.a.graphlib.Graph).setGraph({rankdir:"LR"});this.nodes.forEach(function(n){var r=m([n])[0],a=r.doi,i=1,o=r?r.key:a,s="".concat(o),c=[];r&&0!=r.referenceWithDOI.length||c.push("norefprovided"),c.push("gen".concat(i)),t.setNode(a,{label:s,id:e.doiToCssID(a),class:c.join(" ")})});var n=this.getLinks(),r=Object(q["a"])(n,2),a=r[0],i=r[1];this.drawsecondary&&i.forEach(function(e){t.setEdge(e[0],e[1],{curve:U["a"],style:"stroke: #777; fill:none; stroke-width: 1px;",weight:.05})}),a.forEach(function(e){t.setEdge(e[0],e[1],{curve:U["a"],style:"stroke: #001; fill:none; stroke-width: 2px;",weight:1})});var o=new z.a.render,s=U["c"]("svg");s.selectAll("*").remove();var c=s.append("g"),l=U["c"]("svg>g");l.length=1,o(l,t);var d=s.node().getBoundingClientRect(),u=[d.width,d.height],h=u[0],f=u[1],v=[t.graph().width,t.graph().height],p=v[0],_=v[1],g=.96*Math.min(h/p,f/_),y=(h-g*p)/2,w=(f-g*_)/2;c.attr("transform","translate( ".concat(y,", ").concat(w,") scale(").concat(g,")"));var b=U["d"]().on("zoom",function(){c.attr("transform",U["b"].transform)});s.call(b),b.scaleExtent([g,4*g]),s.selectAll("g.node").on("click",function(n){t.node(n);e.selectednode=n,oe.$emit("showmetadata",n),s.selectAll(".node").classed("selected",!1),s.selectAll("#"+e.doiToCssID(n)).classed("selected",!0)}),s.selectAll(".node rect").attr("rx","3").attr("ry","3"),this.selectednode&&s.selectAll("#"+this.doiToCssID(this.selectednode)).classed("selected",!0)},getLinks:function(){var e=Q(this.nodes),t=J(e),n=Object(q["a"])(t,2),r=n[0],a=n[1];return[r,a]}},components:{}}),X=Y,ee=(n("oZqq"),Object(E["a"])(X,P,F,!1,null,null,null)),te=ee.exports,ne=r["a"].extend({name:"home",components:{grapheditor:S,metadataviewer:L,graphviewer:te},data:function(){return{mainpanel:"editor",graph:null,graphspec:null,drawSecondary:!0,selectednode:void 0,nodelist:se.state.nodelist}},created:function(){var e=this;oe.$on("newgraphrequest",function(t){e.state="building",e.graphspec=t}),oe.$on("graphfinished",function(t){e.state="view",e.graph=t}),oe.$on("showmetadata",function(t){e.selectednode=t}),oe.$on("closemetadata",function(){e.selectednode=void 0}),oe.$on("storageUpdate",function(){e.$forceUpdate()})}}),re=ne,ae=(n("ZL7j"),Object(E["a"])(re,a,i,!1,null,null,null)),ie=ae.exports;n.d(t,"EventBus",function(){return oe}),n.d(t,"graph",function(){return se}),r["a"].config.productionTip=!1;var oe=new r["a"],se={state:{nodelist:[],links:[],secondary:[]},isInNodelist:function(e){var t=this.state.nodelist.filter(function(t){return t.doi==e});return t.length>0},addToGraph:function(e){var t=this;e.forEach(function(e){e=e.toLowerCase(),-1==t.state.nodelist.indexOf(e)&&t.state.nodelist.push(e)})},removeFromGraph:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=this.state.nodelist.indexOf(n.toLowerCase());r>-1&&this.state.nodelist.splice(r,1)}}};new r["a"]({render:function(e){return e(ie)}}).$mount("#app")},zn95:function(e,t,n){}});
//# sourceMappingURL=app.ac2b4872.js.map